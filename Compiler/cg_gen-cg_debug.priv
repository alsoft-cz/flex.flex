----------------------------------------------------------------------------------------------------
module private cg_debug =
-- P©eklada‡ Flexu.
-- Gener tor © dkov˜ch debug informac¡.
----------------------------------------------------------------------------------------------------
-- Ondra : 05.04.2002 : Vytvo©il
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
procedure adddebuginfo =
-- Na konec tabulky debug informac¡ (priv tn¡ tabulka pro danou instanci)
-- dopln¡ zna‡ku soubor-© dek-sloupec-ofset p©¡¨t¡ instrukce od za‡ tku
-- instance
----------------------------------------------------------------------------------------------------
var
  xd               : pdebugtable;
  xdr              : tdebugrec;

begin
  -- je-li tabulka pln  => zvˆt¨it
  if di.d=nil then
    new di.d range 64;
  elsif di.d^:length=di.d^:last then
    --%%TODO(ADJUST) adjust di.d range di.d^:last+64;
    new xd range di.d^:last+64;
    xd^:=di.d^;
    discard di.d;
    di.d:=xd;
    end if;

  -- ulo‘it z znam do tabulky
  --%%TODO(AGGREGATE) di.d^ & tdebugrec[for typ use typ,for ofs use ofs,for pos use pos];
  xdr.typ:=typ;
  xdr.ofs:=ofs;
  xdr.pos:=pos;
  di.d^ & xdr;

#if debug then;
  --dump(longtohex(ofs)+' '+lenstr(tdebugtagtypetxt[typ],10)+' '+lexposblocktostr(pos,true)+lexposblocktofilename(pos));
#end if;
  end adddebuginfo;

end cg_debug;