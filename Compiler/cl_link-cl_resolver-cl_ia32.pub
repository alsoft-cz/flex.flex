----------------------------------------------------------------------------------------------------
module public cl_ia32 =
-- Překladač Flexu.
-- Vyhodnocovač cross-referencí a adres: IA-32.
----------------------------------------------------------------------------------------------------
-- Ondra : 17.04.2002 : Vytvořil
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
class public linkresolver_ia32 =
-- Vyhodnocovač cross-referencí a adres: IA-32.
----------------------------------------------------------------------------------------------------

    with
      cc_base,
      cc_base.cc_util,
      cg_gen,
      cg_gen.cg_ia32,
      cg_gen.cg_ia32.ci_def;

    extend 
      linkresolver;

    ------------------------------------------------------------------------------------------------
    static init (
              _compi   : pentity_compile;      -- kompilační jednotka
              _ibase   : t_unsigned32;         -- image base
              _start   : t_unsigned32;         -- rel. počáteční adresa
              _gran    : t_unsigned32;         -- granulace
              _calign  : t_unsigned32;         -- zarovnání kódu
              _dalign  : t_unsigned32);        -- zarovnání proměných
    -- Inicializace.
    ------------------------------------------------------------------------------------------------

  protected

    type
      -- přídavné informace o segmentech
      tseginfoIA32 = array tsegment of record
          start    : t_unsigned32;               -- počáteční adresa
          len      : t_unsigned32;               -- délka
          end record;

    var
      gran         : t_unsigned32;               -- granulace paměti
      calign       : t_unsigned32;               -- zarovnání kódu
      dalign       : t_unsigned32;               -- zarovnání proměnných
      imagebase    : t_unsigned32;               -- image base
      seg          : tseginfoIA32;               -- informace o segmentech
      compi        : pentity_compile;            -- kompilační jednotka

    ----------------------------------------------------------------------------------------------
    static assign_var_addresses (
        list       : in tentitystring;           -- seznam proměnných
        addr       : in out c_address_aligner_32);-- přidělovač adres
    -- Přidělí adresy proměnným.
    ----------------------------------------------------------------------------------------------
    static build_metadata (
        list       : in tentitystring;           -- seznam proměnných
        addr       : in out c_address_aligner_32);-- přidělovač adres
    -- Sestavení metadat.
    ----------------------------------------------------------------------------------------------
    static resolve_relocations (
        inst       : in out icodeinst);          -- instance
    -- Vyhodnotí relokace daného symbolu.
    ----------------------------------------------------------------------------------------------
    virtual getindirect (
        proc       : pentity_procedure)          -- podprogram
        return t_unsigned32;                     -- adresa
    -- Vrátí nepřímou adresu importovaného podprogramu.
    ----------------------------------------------------------------------------------------------

    end linkresolver_ia32;



----------------------------------------------------------------------------------------------------
class public linkresolver_ia32_win32 = extend linkresolver_ia32;
-- Vyhodnocovač cross-referencí a adres: Win32 na IA-32.
----------------------------------------------------------------------------------------------------

    end linkresolver_ia32_win32;

end cl_ia32;
