----------------------------------------------------------------------------------------------------
module public cl_ia32 =
-- P©eklada‡ Flexu.
-- Vyhodnocova‡ cross-referenc¡ a adres: IA-32.
----------------------------------------------------------------------------------------------------
-- Ondra : 17.04.2002 : Vytvo©il
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
class public linkresolver_ia32 =
-- Vyhodnocova‡ cross-referenc¡ a adres: IA-32.
----------------------------------------------------------------------------------------------------

    with
      cg_gen,
      cg_gen.cg_ia32,
      cg_gen.cg_ia32.ci_def;

    extend 
      linkresolver;

    ------------------------------------------------------------------------------------------------
    static init (
              _compi   : pentity_compile;      -- kompila‡n¡ jednotka
              _ibase   : t_unsigned32;         -- image base
              _start   : t_unsigned32;         -- rel. po‡ te‡n¡ adresa
              _gran    : t_unsigned32;         -- granulace
              _calign  : t_unsigned32;         -- zarovn n¡ k¢du
              _dalign  : t_unsigned32);        -- zarovn n¡ promˆn˜ch
    -- Inicializace.
    ------------------------------------------------------------------------------------------------

  protected

    type
      -- p©¡davn‚ informace o segmentech
      tseginfoIA32 = array tsegment of record
          start    : t_unsigned32;               -- po‡ te‡n¡ adresa
          len      : t_unsigned32;               -- d‚lka
          end record;

    var
      gran         : t_unsigned32;               -- granulace pamˆti
      calign       : t_unsigned32;               -- zarovn n¡ k¢du
      dalign       : t_unsigned32;               -- zarovn n¡ promˆnn˜ch
      imagebase    : t_unsigned32;               -- image base
      seg          : tseginfoIA32;               -- informace o segmentech
      compi        : pentity_compile;            -- kompila‡n¡ jednotka

    ----------------------------------------------------------------------------------------------
    static assignvaraddr (
        list       : in tentitystring;           -- seznam promˆnn˜ch
        addr       : in out t_unsigned32);       -- adresa
    -- P©idˆl¡ adresy promˆnn˜m.
    ----------------------------------------------------------------------------------------------
    static buildtypedesc (
        list       : in tentitystring;           -- seznam promˆnn˜ch
        addr       : in out t_unsigned32);       -- adresa
    -- Sestaven¡ deskriptor– typ–.
    ----------------------------------------------------------------------------------------------
    static resolvereloc (
        inst       : in out icodeinst);          -- instance
    -- Vyhodnot¡ relokace dan‚ho symbolu.
    ----------------------------------------------------------------------------------------------
    virtual getindirect (
        proc       : pentity_procedure)          -- podprogram
        return t_unsigned32;                     -- adresa
    -- Vr t¡ nep©¡mou adresu importovan‚ho podprogramu.
    ----------------------------------------------------------------------------------------------

    end linkresolver_ia32;



----------------------------------------------------------------------------------------------------
class public linkresolver_ia32_win32 = extend linkresolver_ia32;
-- Vyhodnocova‡ cross-referenc¡ a adres: Win32 na IA-32.
----------------------------------------------------------------------------------------------------

    end linkresolver_ia32_win32;

end cl_ia32;