----------------------------------------------------------------------------------------------------
module private fj_engine =
-- Flex Just-in-Time Engine.
----------------------------------------------------------------------------------------------------
-- Ondra : 15.12.2003 : Created.
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
class private c_flex_jit_engine = 
-- Flex Just-in-Time Engine.
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static jit_initialize =
    -- Inicializuje JIT stroj.
    ------------------------------------------------------------------------------------------------
    with
      ff_lib.ff_files;

    use
      cc_def.cc_desc,
      cc_def.cc_var;

    begin
      -- připravit seznam jmen dostupných souborů
      init_external_file_source;

      -- zvolit cílovou platformu (je identická s platformou, pro kterou je tento JIT stroj přeložen)
      cc_def.cc_desc.set_os_family(#environment target_os_family;,os);
      cc_def.cc_desc.set_os_type(#environment target_os_type;,os);
      cc_def.cc_desc.set_os_subsystem(#environment target_os_subsystem_type;,os);
      cc_def.cc_desc.set_cpu_architecture(#environment target_machine_architecture;,os);

      -- nastavit prislusne identifikatory do file_source, aby vedel jake jsou pripustne pripony souboru
      p_file_source_external_files(cc_def.cc_var.cfg_files)^.add_default_extensions;

      -- inicializovat kompilátor
      init(flex_version_string);
      
      -- přeložit modul Flex
      {...}
      end jit_initialize;



    ------------------------------------------------------------------------------------------------
    static jit_execute =
    -- Spustí zadanou kompilační jednotku. Pokud nenajde přeložený modul, JIT-zkompiluje ho.
    ------------------------------------------------------------------------------------------------
    with
      ff_lib.ff_text_output;

    begin
      -- přeložit
      compile(os,config.src_name^,config.exe_name^,config.lib_name^,config.lst_name^,part_type,tpr_library);

      -- vypsat seznam chyb na obrazovku a do listingu
      print_errors(os);
      print_errors(get_listing_writer^);

      -- zavrit soubor listingu
      finalize;
      end jit_execute;



    ------------------------------------------------------------------------------------------------
    static jit_finalize =
    -- Ukončí JIT stroj.
    ------------------------------------------------------------------------------------------------
    begin
      end jit_finalize;

    end c_flex_jit_engine;

end fj_engine;