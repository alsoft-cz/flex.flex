----------------------------------------------------------------------------------------------------
module private cc_util =
-- P©eklada‡ Flexu.
-- R–zn‚ u‘ite‡n‚ procedury.
----------------------------------------------------------------------------------------------------
-- Ondra : 08.04.2001 : Vytvo©il
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
procedure addalign =
-- X:=Y+Z se zarovn n¡m na ALIGN.                                             
----------------------------------------------------------------------------------------------------
begin
  x:=((y+z+align-1) div align)*align;
  end addalign;



----------------------------------------------------------------------------------------------------
class private c_address_aligner_32 =
-- Producent zarovnan˜ch adres - sekven‡n¡ p©idˆlova‡ adres.
----------------------------------------------------------------------------------------------------

    with
      cc_def;

    var
      curr_address : t_unsigned32;               -- aktu ln¡ adresa
      curr_size    : t_unsigned32;               -- dosud registrovan  velikost
      alignment    : t_unsigned32;               -- platn‚ zarovn n¡

    ------------------------------------------------------------------------------------------------
    static init =
    -- Nastav¡ po‡ te‡n¡ adresu a zarovn n¡.
    ------------------------------------------------------------------------------------------------
    begin
      verify(699,_alignment=0);
      curr_address:=_address;
      curr_size:=0;
      alignment:=_alignment;
      end init;



    ------------------------------------------------------------------------------------------------
    static get_address =
    -- Vr t¡ aktu ln¡ adresu.
    ------------------------------------------------------------------------------------------------
    begin
      -- vr tit adresu s ohledem na dosud zapo‡ten‚ kousky
      result:=curr_address+curr_size;
      end get_address;



    ------------------------------------------------------------------------------------------------
    static get_address_and_adjust =
    -- Vr t¡ aktu ln¡ adresu a pro p©¡¨tˆ ji posune o hodnotu [_size]+<zarovn n¡>.
    -- Pozor, na dosud registrovanou velikost posunut¡ nebere ohled!
    ------------------------------------------------------------------------------------------------
    begin
      verify(698,curr_size<>0);

      -- p©idˆlit adresu
      result:=get_address;

      -- spo‡¡tat p©¡¨t¡ adresu
      shift_address(_size);
      end get_address_and_adjust;



    ------------------------------------------------------------------------------------------------
    static register_size =
    -- Registruje ‡ st velikosti, o kterou se bude posouvat adresa.
    ------------------------------------------------------------------------------------------------
    begin
      -- zapo‡¡st pou‘it˜ kousek adresn¡ho prostoru
      curr_size+_size;
      end register_size;



    ------------------------------------------------------------------------------------------------
    static compute_next_address =
    -- Spo‡¡t  p©¡¨t¡ adresu na z kladˆ dosud registrovan˜ch hodnot.
    ------------------------------------------------------------------------------------------------
    begin
      shift_address(curr_size);
      curr_size:=0;
      end compute_next_address;



    ------------------------------------------------------------------------------------------------
    static shift_address =
    -- Jednor zovˆ posune adresu o uvedenou velikost s ohledem na zarovn n¡. 
    -- Nem  vliv na dosud registrovanou velikost pomoc¡ [register_size].
    ------------------------------------------------------------------------------------------------
    begin
      addalign(curr_address,curr_address,_size,alignment);
      end shift_address;

    end c_address_aligner_32;

end cc_util;