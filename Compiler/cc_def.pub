----------------------------------------------------------------------------------------------------
module public cc_def =
-- Překladač Flexu.
-- Základní deklarace.
----------------------------------------------------------------------------------------------------
-- Ondra : 25.04.2000 : Vytvořil
----------------------------------------------------------------------------------------------------

with
  standard;

----- Základní deklarace ---------------------------------------------------------------------------
type
  -- společný předek interních struktur překladače
  t_flex_record    = record
      end record;
  p_flex_record    = ^class t_flex_record;

----------------------------------------------------------------------------------------------------
class abstract c_flex_class = 
-- Společný předek interních tříd překladače.
----------------------------------------------------------------------------------------------------
    
    end c_flex_class;

----------------------------------------------------------------------------------------------------
class abstract c_flex_construct = extend c_flex_class;
-- Společný předek interních tříd překladače reprezentujících nějakou jazykovou konstrukci.
----------------------------------------------------------------------------------------------------

    var
      erroneous    : t_logical;                  -- příznak, zda v této konstrukci je chyba

    ------------------------------------------------------------------------------------------------
    virtual abstract errpos;
    -- K poslední hlášené chybě/hintu/warningu/... doplní pozici odpovídající této konstrukci.
    ------------------------------------------------------------------------------------------------

    end c_flex_construct;

type
  p_flex_class     = ^class c_flex_class;
  p_flex_construct = ^class c_flex_construct;

type
  -- způsob, jak zachytávat chybu resume_error
  t_catch_mode     = enum
      catch_mode_implicit;                       -- implicitní chování - záleží na typu uzlu
      catch_mode_catch;                          -- vždy zachytí chybu
      catch_mode_raise;                          -- zachycená chyba je znovu vyvolána
      end enum;


----- Identifikátory -------------------------------------------------------------------------------
type
  -- znak identifikátoru
  tidentchar       = protected character 32;

  -- identifikátor entity
  tentityident     = private string of tidentchar;
  pentityident     = ^tentityident;

  -- interní zkrácený identifikátor
  tshortident      = protected tentityident range 63;
  pshortident      = ^tshortident;

const
  -- NIL systémového řetězce
  sysstr_nil       = '';
  sysstr_nil_image = 'NIL';


----------------------------------------------------------------------------------------------------
procedure entityident_to_string (
    ident          : in tentityident)
                   return t_char32str;
-- Převede identifikátor na řetězec.
----------------------------------------------------------------------------------------------------

{
----------------------------------------------------------------------------------------------------
#template verify (code,cond);
----------------------------------------------------------------------------------------------------
  if cond then _verify(code,true) end if;
  #end verify;

----------------------------------------------------------------------------------------------------
#template verifyx (code,cond,pos);
----------------------------------------------------------------------------------------------------
  if cond then _verifyx(code,true,pos) end if;
  #end verifyx;

----------------------------------------------------------------------------------------------------
#template verifyc (code,cond);
----------------------------------------------------------------------------------------------------
  if cond then _verifyc(code,true) end if;
  #end verifyc;
}
----------------------------------------------------------------------------------------------------
procedure verify (
    code           : in t_unsigned;              -- kod interní chyby
    cond           : in t_logical := true);      -- T-chyba
-- Je-li COND=True způsobí interní chybu CODE.
----------------------------------------------------------------------------------------------------
procedure unimplemented (
    code           : in t_unsigned);             -- kod interní chyby
-- Způsobí chybu Neimplementováno.
----------------------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------------------
#separate public cc_unitype;
#separate private cc_unitype;
-- Univerzální aritmetika.
----------------------------------------------------------------------------------------------------
#separate cc_codes;
-- Kódy chyb a varování
----------------------------------------------------------------------------------------------------



----- Parametry překladače -------------------------------------------------------------------------
type
  -- parametry překladu
  tcompvar         = record
      options      : p_flex_record;              -- parametry překladače
      warns        : cc_codes.twarningcodeset;   -- varování
      hints        : cc_codes.thintcodeset;      -- hinty
      diags        : cc_codes.tdiagcodeset;      -- diagnostická hlášení
      end record;
var
{%OFF}
  opt_warning      : const tshortident := 'WARNING';
  opt_hint         : const tshortident := 'HINT';
  opt_diag         : const tshortident := 'DIAGNOSTIC';
{%ON}

----------------------------------------------------------------------------------------------------
#separate public cc_lexsym;
-- Definice lexikálních symbolů.
----------------------------------------------------------------------------------------------------
#separate public cc_desc;
-- Popisy cílových platforem.
----------------------------------------------------------------------------------------------------
#separate public cc_env;
-- #environment proměnné.
----------------------------------------------------------------------------------------------------
#separate public cc_entity;
-- Definice tabulky symbolů.
----------------------------------------------------------------------------------------------------
#separate public cc_errors;
-- Seznam chybových hlášení.
----------------------------------------------------------------------------------------------------
#separate public cc_tree;
-- Společné deklarace pro rozklad výrazu a bloku.
----------------------------------------------------------------------------------------------------
#separate public cc_cpuspecific;
#separate private cc_cpuspecific;
-- Vlastnosti specifické pro konkrétní procesor.
----------------------------------------------------------------------------------------------------
#separate public cc_osspecific;
#separate private cc_osspecific;
-- Vlastnosti specifické pro konkrétní operační systém.
----------------------------------------------------------------------------------------------------
#separate public cc_files;
-- Seznam souborů.
----------------------------------------------------------------------------------------------------
#separate public cc_var;
#separate private cc_var;
-- Řídící proměnné pro překlad.
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
procedure verifyx (
    code           : in t_unsigned;              -- kod interní chyby
    cond           : in t_logical;               -- T-chyba
    pos            : in cc_lexsym.lexposblock);  -- pozice chyby
-- Je-li [cond]=True způsobí interní chybu [code]. Pozici chyby nastaví na [pos].
----------------------------------------------------------------------------------------------------
procedure verifyc (
    code           : in t_unsigned;              -- kod interní chyby
    cond           : in t_logical := true);      -- T-chyba
-- Je-li [cond]=True způsobí interní chybu [code]. Pozici nastaví na aktuální lexikální element.
----------------------------------------------------------------------------------------------------
procedure unimplementedx (
    code           : in t_unsigned;              -- kod interní chyby
    pos            : in cc_lexsym.lexposblock);  -- pozice chyby
-- Způsobí chybu Neimplementováno.
----------------------------------------------------------------------------------------------------

end cc_def;
