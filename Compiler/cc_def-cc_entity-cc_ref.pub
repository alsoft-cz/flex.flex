----------------------------------------------------------------------------------------------------
module public cc_ref =
-- Překladač Flexu.
-- Reference mezi entitami.
----------------------------------------------------------------------------------------------------
-- Ondra : 25.06.2001 : Vytvořil
----------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------------------
class public ref0 = extend c_flex_class;
-- Reference na objekt
----------------------------------------------------------------------------------------------------

    var
      e            : tentityeval;                -- vyhodnocení reference

    ------------------------------------------------------------------------------------------------
    static geteval return tentityeval;
    -- Zjistí úroveň vyhodnocení reference.
    ------------------------------------------------------------------------------------------------
    static seteval (
        e          : tentityeval);
    -- Nastaví novou úroveň vyhodnocení reference.
    ------------------------------------------------------------------------------------------------

    end ref0;



----------------------------------------------------------------------------------------------------
class refexpr; type prefexpr = ^refexpr;
class public refexpr = extend ref0;
-- Reference na objekt: výraz
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static isset return t_logical;
    -- True, je-li reference přiřazena.
    ------------------------------------------------------------------------------------------------
    static getuexpr return p_flex_construct;
    -- Vrátí odkazovaný výraz. Pokud není přiřazen, vrátí NIL.
    ------------------------------------------------------------------------------------------------
    static getcexpr return p_flex_construct;
    -- Vrátí odkazovaný výraz. Pokud není přiřazen, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static setexpr (
        x          : in p_flex_construct);
    -- Přiřadí do reference výraz.
    ------------------------------------------------------------------------------------------------
    static errpos;
    -- Pozice chyby ve zdrojáku.
    ------------------------------------------------------------------------------------------------

    end refexpr;



----------------------------------------------------------------------------------------------------
class public ref1 = extend ref0;
-- Reference na objekt s výrazem
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static getrefexpr return prefexpr;
    -- Vrátí odkaz na související výraz.
    ------------------------------------------------------------------------------------------------
    static getuexpr return p_flex_construct;
    -- Vrátí odkazovaný výraz. Pokud není přiřazen, vrátí NIL.
    ------------------------------------------------------------------------------------------------
    static getcexpr return p_flex_construct;
    -- Vrátí odkazovaný výraz. Pokud není přiřazen, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static setexpr (
        x          : in p_flex_construct);
    -- Přiřadí do reference výraz.
    ------------------------------------------------------------------------------------------------

  protected

    var
      _x           : prefexpr;                   -- výraz

    end ref1;



----------------------------------------------------------------------------------------------------
class public reftype = extend ref1;
-- Reference na objekt: typ
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static getutype return pentity_type;
    -- Vrátí odkazovaný typ. Pokud není přiřazen, vrátí NIL.
    ------------------------------------------------------------------------------------------------
    static getctype return pentity_type;
    -- Vrátí odkazovaný typ. Pokud není přiřazen, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static settype (
        ptyp       : in pentity_type;
        clear_expr : in t_logical := true);      -- T-zapomenout přiřazený výraz, F-ponechat
    -- Přiřadí do reference typ.
    ------------------------------------------------------------------------------------------------
    static isset return t_logical;
    -- True, je-li reference přiřazena.
    ------------------------------------------------------------------------------------------------
    static errpos;
    -- Pozice chyby ve zdrojáku.
    ------------------------------------------------------------------------------------------------

    end reftype;



----------------------------------------------------------------------------------------------------
class public refblock = extend ref0;
-- Reference na objekt: blok příkazů
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static setblock (
        b          : p_flex_class);
    -- Přiřadí do reference blok.
    ------------------------------------------------------------------------------------------------
    static getublock return p_flex_class;
    -- Vrátí odkazovaný blok. Pokud není přiřazen, vrátí NIL.
    ------------------------------------------------------------------------------------------------
    static getcblock return p_flex_class;
    -- Vrátí odkazovaný blok. Pokud není přiřazen, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static isset return t_logical;
    -- True, je-li reference přiřazena.
    ------------------------------------------------------------------------------------------------

    end refblock;



----------------------------------------------------------------------------------------------------
class public refentity = extend ref1;
-- Reference na objekt: entita
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static setentity (
        e          : in pentity);
    -- Přiřadí do reference symbol.
    ------------------------------------------------------------------------------------------------
    static getuentity return pentity;
    -- Vrátí odkazovanou entitu. Pokud není přiřazena, vrátí NIL.
    ------------------------------------------------------------------------------------------------
    static getcentity return pentity;
    -- Vrátí odkazovanou entitu. Pokud není přiřazena, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static isset return t_logical;
    -- True, je-li entita přiřazena.
    ------------------------------------------------------------------------------------------------
    static errpos;
    -- Pozice chyby ve zdrojáku.
    ------------------------------------------------------------------------------------------------

    end refentity;



----------------------------------------------------------------------------------------------------
class public refimm = extend ref1;
-- Reference na objekt: přímá hodnota
----------------------------------------------------------------------------------------------------

    ------------------------------------------------------------------------------------------------
    static getuimm return pimm_value;
    -- Vrátí pointer na odkazovanou přímou hodnotu.    
    ------------------------------------------------------------------------------------------------
    static getimm return pimm_value;
    -- Vrátí pointer na odkazovanou přímou hodnotu.
    -- Pokud je přímá hodnota typu IC_UNDEF, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static getundefimm return pimm_value;
    -- Vrátí pointer na odkazovanou přímou hodnotu.
    -- Pokud přímá hodnota není typu IC_UNDEF, způsobí interní chybu.
    ------------------------------------------------------------------------------------------------
    static isset return t_logical;
    -- True, je-li reference přiřazena.
    ------------------------------------------------------------------------------------------------
    static errpos;
    -- Pozice chyby ve zdrojáku.
    ------------------------------------------------------------------------------------------------

    end refimm;



end cc_ref;
