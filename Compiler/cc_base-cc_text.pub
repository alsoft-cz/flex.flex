----------------------------------------------------------------------------------------------------
module public cc_text =
-- P©eklada‡ Flexu.
-- €ten¡ zdroj ku.
----------------------------------------------------------------------------------------------------
-- Ondra : 25.04.2000 : Vytvo©il
----------------------------------------------------------------------------------------------------

with
  standard,
  standard.names,
  standard.streams,
  cc_def;

extend
  cc_def.cc_lexsym;


--forward
class c_source_file; type p_source_file = ^c_source_file;


----------------------------------------------------------------------------------------------------
class public c_source_file =
----------------------------------------------------------------------------------------------------
var
  metastack        : string 100 of tmetastackitem; -- z sobn¡k preprocesoru

  ------------------------------------------------------------------------------------------------
  static open(
        name       : in t_text_name;             -- jm‚no otv¡ran‚ho souboru
        include    : in t_logical);              -- T-soubor je includovan˜
  -- Otev©e soubor a p©iprav¡ ho pro ‡ten¡.
  --------------------------------------------------------------------------------------------------
  static close;
  -- Zavre soubor
  --------------------------------------------------------------------------------------------------
  static get_full_name(
        name       : out p_text_name);
  -- Zjisti jmeno souboru
  ------------------------------------------------------------------------------------------------
  static get_file_name return c_name;
  -- Zjisti jmeno souboru
  ------------------------------------------------------------------------------------------------
  static getchar(
        char       : out lexchar);
  -- P©e‡te znak ze vstupu. Na konci vstupu vr t¡ \0, p©¡padn‚ znaky \0 v souboru nijak 
  -- neo¨et©uje, tak‘e se u‘ivatel mus¡ je¨tˆ ujistit vol n¡m [is_eof].
  -- Po p©e‡ten¡ nov‚ho znaku ze vstupu inkrementuje po‡¡tadlo sloupc–. Nijak neo¨et©uje konce
  -- © dk–. Aktualizace po‡¡tadla © dk– je ponech na na u‘ivateli.
  --------------------------------------------------------------------------------------------------
  static ungetchar;
  -- Vr t¡ naposledy p©e‡ten˜ znak do vstupu.
  --------------------------------------------------------------------------------------------------
  static is_eof return t_logical;
  -- True, jestli‘e ji‘ byl p©e‡ten cel˜ soubor.
  --------------------------------------------------------------------------------------------------
  static next_line;
  -- Posune po‡¡tadlo © dk– o jedni‡ku a zresetuje po‡¡tadlo sloupc–.
  ------------------------------------------------------------------------------------------------
  static get_lines return t_unsigned;
  -- Dosud zpracovan˜ po‡et © dk– souboru.
  ------------------------------------------------------------------------------------------------
  static get_position (
      pos        : out lexpos);                -- pozice
  -- Zjist¡ aktu ln¡ pozici ve zdroj ku.
  ------------------------------------------------------------------------------------------------
  static get_length (
      pos        : in out lexpos);             -- pozice
  -- Podle zapamatovan‚ pozice dopo‡¡t  d‚lku lexik ln¡ho elementu.
  ------------------------------------------------------------------------------------------------
  static is_include return t_logical;
  -- T-soubor je includovan˜
  ------------------------------------------------------------------------------------------------
  static is_effective return t_logical;
  -- T-posledn¡ zpracov van˜ © dek byl efektivn¡
  ------------------------------------------------------------------------------------------------
  static set_effective;
  -- nastavi ze posledn¡ zpracov van˜ © dek byl efektivn¡
  ------------------------------------------------------------------------------------------------
  static check_meta_statements;
  -- Zkontroluje, zda jsou uzav©eny v¨echny blokov‚ metap©¡kazy.
  ------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------
supervised
------------------------------------------------------------------------------------------------
    var
      next         : p_source_file;              -- dal¨¡ soubor na z sobn¡ku
  end c_source_file;



----------------------------------------------------------------------------------------------------
procedure text_open (
    name           : in t_text_name;             -- jm‚no otv¡ran‚ho souboru
    include        : in t_logical);              -- T-soubor je includovan˜
-- Otev©e nov˜ soubor zadan‚ho jm‚na a um¡st¡ ho na vrchol z sobn¡ku otev©en˜ch soubor–.
----------------------------------------------------------------------------------------------------
procedure text_close;
-- Zav©e soubor na vrcholu z sobn¡ku otev©en˜ch soubor– a p©ejde k nad©azen‚mu.
-- P©ed zav©en¡m zkontroluje ukon‡en¡ v¨ech blokov˜ch metap©¡kaz– v aktu ln¡m souboru.
----------------------------------------------------------------------------------------------------

--%%TODO supervised

var
  lex_input        : p_source_file;

end cc_text;
