----------------------------------------------------------------------------------------------------
module public ci_context =
-- P©eklada‡ Flexu.
-- Operace s kontextem generov n¡ v˜razu.
----------------------------------------------------------------------------------------------------
-- Ondra : 05.04.2002 : Vytvo©il
----------------------------------------------------------------------------------------------------

with
  cc_def.cc_unitype,
  cp_cpu.cp_ia32.ci_instr,
  ci_def;

----------------------------------------------------------------------------------------------------
procedure i_createcontext (
    context        : out iexprcontext;           -- kontext generov n¡ v˜razu
    mode           : in iexprloadmode;           -- re‘im zpracov n¡ v˜razu
    typ            : in pentity_type);           -- o‡ek van˜ typ v˜razu
-- Vytvo©¡ nov˜ kontext.
-- Po‘adovanou velikost a znam‚nko registr– (CONTEXT.RSIZE a CONTEXT.RSIGN)
-- odvod¡ z o‡ek van‚ho typu v˜razu. Je-li NIL, dosad¡ IDEFREGSIZE a False.
----------------------------------------------------------------------------------------------------
procedure i_newcontext (
    oldcontext     : in iexprcontext;            -- kontext generov n¡ v˜razu
    newcontext     : out iexprcontext;           -- kontext generov n¡ v˜razu
    mode           : in iexprloadmode;           -- re‘im zpracov n¡ v˜razu
    typ            : in pentity_type);           -- o‡ek van˜ typ v˜razu
-- Ze star‚ho kontextu odvod¡ nov˜ a dosad¡ do nˆj aktualizovan‚ £daje.
-- Po‘adovanou velikost a znam‚nko registr– (CONTEXT.RSIZE a CONTEXT.RSIGN)
-- odvod¡ z o‡ek van‚ho typu v˜razu. Je-li NIL, dosad¡ IDEFREGSIZE a False.
-- O‡ek van˜ typ v˜sledku se implicitnˆ p©eb¡r  ze star‚ho kontextu s t¡m, ‘e
-- m¡sto nˆj lze dosadit TYP je-li TYP<>NIL.
----------------------------------------------------------------------------------------------------
-- %%TECH Operace p©eveden¡ nastaven¡ subcontextu do supercontextu je sice operac¡ na kontexty, ale
-- mus¡ b˜t implementov na jako metoda [c_operand], kter˜ se mezi kontexty mimochodem p©ev dn¡, 
-- proto‘e implementace v r mci [ci_context] zp–sobuje netrivi lnˆ odstranitelnou circular 
-- reference. Konkr‚tnˆ [ci_operand.c_operand] pot©ebuje [ci_reg], ten [ci_context], ale 
-- [ci_context], kter˜ by implementoval p©eveden¡ kontextu by nebylo mo‘n‚ p©ekl dat bez p©elo‘en¡ 
-- [ci_operand].
--
--procedure i_retrieve_context (
--    inst           : in out icodeinst;           -- instance
--    info           : in igeninfo;                -- informace o p©ekladu
--    subcontext     : in iexprcontext;            -- kontext podv˜razu
--    context        : in out iexprcontext;        -- aktu ln¡ kontext v˜razu
--    oper           : in c_operand);              -- operand reprezentuj¡c¡ n vratovou hodnotu
-- P©evede nastaven¡ subcontextu v‡etnˆ jednoho operandu reprezentuj¡c¡ho n vratovou hodnotu do 
-- nad©azen‚ho kontextu.
----------------------------------------------------------------------------------------------------
procedure i_setrpref (
    context        : in out iexprcontext;        -- kontext generov n¡ v˜razu
    uni            : in iunireg;                 -- registr
    mode           : in iregallocmode);          -- pro jak˜ re‘im p©idˆlov n¡
-- P©i©ad¡ kontextu preferovan˜ registr.
----------------------------------------------------------------------------------------------------
procedure i_setoutpref (
    context        : in out iexprcontext;        -- kontext generov n¡ v˜razu
    outpref        : in ioutputpref);            -- preferovan  metoda p©ed n¡ v˜sl.
-- P©i©ad¡ kontextu preferovanou metodu p©ed n¡ v˜sledku.
----------------------------------------------------------------------------------------------------
procedure i_compose_outtyp (
    context        : in out iexprcontext;        -- kontext generov n¡ v˜razu
    stype          : in tdatatype;               -- druh typu
    size           : in tunidata_size;           -- velikost
    pattrib        : in rtattribset;             -- ulo‘en‚ dynamick‚ atributy
    base           : in pentity_type);           -- b zov˜ typ
-- P©i©ad¡ kontextu preferovanou metodu p©ed n¡ v˜sledku.
----------------------------------------------------------------------------------------------------

end ci_context;
