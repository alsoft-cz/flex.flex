----------------------------------------------------------------------------------------------------
module private cl_link =
-- Překladač Flexu.
-- Univerzální linker.
----------------------------------------------------------------------------------------------------
-- Ondra : 12.04.2002 : Vytvořil
----------------------------------------------------------------------------------------------------

with
  standard,
  cc_def.cc_entity.cc_list;

----------------------------------------------------------------------------------------------------
#separate private cl_def;
-- Základní definice pro linker.
----------------------------------------------------------------------------------------------------
#separate public cl_map;
-- Generátor map filu.
----------------------------------------------------------------------------------------------------
#separate private cl_map;
-- Generátor map filu.
----------------------------------------------------------------------------------------------------
#separate private cl_resolver;
-- Vyhodnocovač cross-referencí a adres.
----------------------------------------------------------------------------------------------------
#separate private cl_image;
-- Generátor výstupních souborů.
----------------------------------------------------------------------------------------------------
#separate private cl_debug;
-- Generátor debug informací.
----------------------------------------------------------------------------------------------------



----------------------------------------------------------------------------------------------------
procedure dump (name : in t_char32str; list : in tentitystring) =
----------------------------------------------------------------------------------------------------
with
  standard.console,
  cc_base,cc_base.cc_sym;

begin
  write_line('');
  write_line(name);
  if list.list<>nil then
    for i in list.list^:range loop
      write_line(sym_get_qid(list.list^[i]));
      end loop;
    end if;
  end dump;



----------------------------------------------------------------------------------------------------
procedure l_link =
-- Hlavní smyčka linkeru.
----------------------------------------------------------------------------------------------------
begin
  -- označit symboly pro linkování
  resolver.mark(compi);

  -- setavit
  resolver.link;

  --dump('Code',resolver.code);
  --dump('Reloc',resolver.reloc);
  --dump('IData',resolver.idata);
  --dump('Data',resolver.data);
  --dump('Import',resolver.import);
  --dump('TypeDesc',resolver.typedesc);

  -- do listingu ještě doplnit nějaké údaje
  resolver.info;
  end l_link;



----------------------------------------------------------------------------------------------------
procedure l_build_image =
-- Sestavení výstupního souboru.
----------------------------------------------------------------------------------------------------
begin
  -- sestavit výstupní soubor
  image.create(resolver,compi^.part_result=tpr_library);

  -- do listingu ještě doplnit nějaké údaje
  image.info;
  end l_build_image;

end cl_link;
