----------------------------------------------------------------------------------------------------
module public ci_asm =
-- P©eklada‡ Flexu.
-- Parser inline assembleru.
----------------------------------------------------------------------------------------------------
-- Ondra : 05.04.2002 : Vytvo©il
----------------------------------------------------------------------------------------------------

----- %%TECH Syntaxe inline assembleru IA-32 -------------------------------------------------------  
-- 
-- Text v assembleru  { Prvek textu }
-- 
-- Prvek textu        Jm‚no n vˆ¨t¡ :
--                    Instrukce
-- 
-- Instrukce          Jm‚no instrukce  [ Operand [ , Operand [ , Operand ]]]
-- 
-- Operand            Jm‚no registru
--                    [ "<" Jm‚no typu ">" ] "(" Konstantn¡ diskr‚tn¡ v˜raz ")"
--                    "(" Tag ")"
--                    "(" V˜jimka ")"
--                    [ "<" Jm‚no typu ">" ] "[" Efektivn¡ adresa "]"
--                    [ "<" Jm‚no typu ">" ] "(" Jm‚no promˆnn‚ ")"
--                            [ "[" Efektivn¡ adresa "]" ]
-- 
-- Efektivn¡ adresa   Posunut¡
--                    B ze [ + Posunut¡ ]
--                    B ze + Index [ * Mˆ©¡tko ] [ +|- Posunut¡ ]
--                    B ze + Index * Mˆ©¡tko
--                    Index [ * Mˆ©¡tko ] [ +|- Posunut¡ ]
-- 
----------------------------------------------------------------------------------------------------*)

with
  cc_def.cc_lexsym,
  cp_cpu.cp_ia32.ci_instr,
  ci_def;

extend
  cp_cpu.cp_ia32.ci_asm;

type
  -- dop©edn‚ deklarace
  iasmnode;        piasmnode        = ^class iasmnode;
  iasmnode_instr;  piasmnode_instr  = ^class iasmnode_instr;
  iasmnode_label;  piasmnode_label  = ^class iasmnode_label;

  -- typ elementu inline assembleru
  iasmnodetyp      = enum
      ian_instruction;                           -- instrukce
      ian_label;                                 -- n vˆ¨t¡
      end enum;

  -- jeden element inline assembleru
  iasmnode         = tflexrecord with record
      next         : piasmnode;      
      ntype        : iasmnodetyp;                -- instrukce/n vˆ¨t¡/...
      pos          : lexposblock;                -- pozice ve zdrojov‚m souboru
      end record;

  -- instrukce
  iasmnode_instr   = iasmnode with record
      prefix       : iprefix;                    -- prefix instrukce
      ii           : iinstr;                     -- instrukce
      op           : array 1..3 of ioper;        -- operandy
      end record;

  -- n vˆ¨t¡
  iasmnode_label   = iasmnode with record
    --pos          : piasmlabellist; -- odkaz do tabulky n vˆ¨t¡
      target       : itarget;                    -- identifikace n vˆ¨t¡ v gener toru k¢du
      plabel       : pentity_label;              -- souvisej¡c¡ n vˆ¨t¡
      end record;



end ci_asm;